<!-- 
  Player Control HUD (PCH) - HTML 模板
  布局逻辑: 双翼拱月 (Double Wing Arching Moon)
  版本: V13 适配版
-->
<div id="xjzl-player-hud">

    <!-- 1. 左翼：战阵四维 (纯展示) -->
    <!-- 通过 top 属性与头像顶部对齐 -->
    <div class="hud-wing left">
        <div class="combat-stat-grid">
            {{#each leftStats}}
            <div class="c-stat" title="{{label}}">
                <span class="label">{{label}}</span>
                <span class="val">{{value}}</span>
            </div>
            {{/each}}
        </div>
    </div>

    <!-- 2. 中庭：本我 (核心区域) -->
    <div class="hud-center">

        <!-- 架招 Badge (顶端悬浮，点击取消) -->
        {{#if stanceName}}
        <div class="stance-badge" data-action="stop-stance" data-tooltip="{{stanceDesc}}" data-tooltip-direction="UP">

            <i class="fas fa-shield-alt"></i> {{stanceName}}
            <!-- 提示语可以放在 tooltip 里，这里就不写 title 属性了，防止冲突 -->
            <span class="sub-text">(点击解除)</span>
        </div>
        {{/if}}

        <!-- 核心立绘容器 -->
        <div class="avatar-wrapper">
            <!-- 头像框 -->
            <div class="avatar-frame clickable" data-action="open-sheet" title="点击打开角色面板">
                <img src="{{actorImg}}" class="avatar-img">
                <div class="aura-ring {{neigongElement}}"></div>
            </div>

            <!-- 境界印章 (右上角肩章) -->
            {{#if realmName}}
            <div class="realm-seal">{{realmName}}</div>
            {{/if}}

            <!-- 怒气环绕系统 (半圆排列) -->
            <div class="rage-ring-container">
                {{#each rageDots}}
                <!-- index 用于 CSS 计算旋转角度 -->
                <div class="rage-orb {{#if this.active}}active{{/if}}" style="--i:{{@index}}"></div>
                {{/each}}
            </div>

            <!-- 怒气核心 (底部输入框) -->
            <div class="rage-core" title="当前怒气">
                <!-- 装饰图标 (绝对定位在顶部) -->
                <i class="fas fa-fire"></i>
                <!-- 输入框 (绝对定位在底部，确保居中) -->
                <input type="text" class="res-input rage-input" data-target="system.resources.rage.value"
                    value="{{rage.value}}">
            </div>
        </div>

        <!-- 折叠/展开按钮 -->
        <div class="toggle-hud-btn" data-action="toggle-collapse">
            <i class="fas fa-chevron-down"></i>
        </div>
    </div>

    <!-- 3. 右翼：气血内力 (可编辑) -->
    <div class="hud-wing right">
        <!-- HP 条 -->
        <div class="res-bar hp">
            <div class="bar-fill" style="width: {{hpPercent}}%;"></div>
            <!-- 护体真气光罩 (覆盖层) -->
            <!-- style="width: {{hutiPercent}}%" 控制长度 -->
            <div class="bar-shield" style="width: {{hutiPercent}}%;"></div>
            <div class="bar-text">
                <!-- data-target 用于 JS 自动绑定更新 -->
                <input type="text" class="res-input" data-target="system.resources.hp.value" value="{{hp.value}}">
                <span class="sep">/</span>
                <span class="max">{{hp.max}}</span>
            </div>
            <!-- 4. 护体数值徽章 (浮动显示) -->
            {{#if hutiValue}}
            <div class="huti-badge" title="护体真气">
                <i class="fas fa-shield-alt"></i>
                <input type="text" class="res-input huti-input" data-target="system.resources.huti"
                    value="{{hutiValue}}">
            </div>
            {{/if}}
        </div>
        <!-- MP 条 -->
        <div class="res-bar mp">
            <div class="bar-fill" style="width: {{mpPercent}}%;"></div>
            <div class="bar-text">
                <input type="text" class="res-input" data-target="system.resources.mp.value" value="{{mp.value}}">
                <span class="sep">/</span>
                <span class="max">{{mp.max}}</span>
            </div>
        </div>
    </div>

    <!-- 4. 底座：万象森罗 (操作按钮) -->
    <div class="hud-dock">
        <!-- 常用招式 -->
        <div class="dock-category">
            <div class="cat-btn"><i class="fas fa-fist-raised"></i></div>
            <div class="cat-content">
                <div class="scroll-area">
                    {{#each shortcuts}}
                    <div class="item-btn move" data-action="use-move" data-item-id="{{item.id}}"
                        data-move-id="{{move.id}}" title="{{move.name}}">
                        <img src="{{item.img}}">
                        <span class="label">{{move.name}}</span>
                    </div>
                    {{/each}}
                    {{#unless shortcuts}}
                    <div class="empty-tip">无常用招式</div>
                    {{/unless}}
                </div>
            </div>
        </div>

        <!-- 消耗品 -->
        <div class="dock-category">
            <div class="cat-btn"><i class="fas fa-flask"></i></div>
            <div class="cat-content">
                <div class="scroll-area">
                    {{#each consumables}}
                    <div class="item-btn" data-action="use-item" data-item-id="{{id}}" title="{{name}}">
                        <img src="{{img}}">
                        <span class="qty">{{system.quantity}}</span>
                    </div>
                    {{/each}}
                </div>
            </div>
        </div>

        <!-- 装备 -->
        <div class="dock-category">
            <div class="cat-btn"><i class="fas fa-tshirt"></i></div>
            <div class="cat-content">
                <div class="scroll-area">
                    {{#each equipments}}
                    <div class="item-btn {{#if system.equipped}}equipped{{/if}}" data-action="toggle-equip"
                        data-item-id="{{id}}" title="{{name}}">
                        <img src="{{img}}">
                        {{#if system.equipped}}<i class="fas fa-check equip-mark"></i>{{/if}}
                    </div>
                    {{/each}}
                </div>
            </div>
        </div>

        <!-- 属性检定 -->
        <div class="dock-category">
            <div class="cat-btn"><i class="fas fa-dice-d20"></i></div>
            <div class="cat-content">
                <div class="attr-grid">
                    {{#each stats}}
                    <div class="attr-btn" data-action="roll-stat" data-key="{{key}}">{{label}}</div>
                    {{/each}}
                    <div class="attr-btn skill" data-action="roll-stat" data-key="qinggong">轻功</div>
                    <div class="attr-btn skill" data-action="roll-stat" data-key="jianding">鉴定</div>
                    <div class="attr-btn skill" data-action="roll-stat" data-key="tancha">探查</div>
                </div>
            </div>
        </div>
    </div>
</div>
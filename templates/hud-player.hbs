<!-- Player Control HUD (PCH) - 模板文件 -->
<div id="xjzl-player-hud">

    <!-- 1. 左翼：战阵四维 -->
    <div class="hud-wing left">
        <div class="combat-stat-grid">
            {{#each leftStats}}
            <div class="c-stat" data-tooltip="{{label}}">
                <span class="label">{{label}}</span>
                <span class="val">{{value}}</span>
            </div>
            {{/each}}
        </div>
    </div>

    <!-- 2. 中庭：本我 -->
    <div class="hud-center">
        <!-- 架招 Badge -->
        {{#if stanceName}}
        <div class="stance-badge" data-action="stop-stance" data-tooltip="{{stanceDesc}}" data-tooltip-direction="UP">
            <i class="fas fa-shield-alt"></i> {{stanceName}}
        </div>
        {{/if}}

        <div class="avatar-wrapper">
            <div class="avatar-frame clickable" data-action="open-sheet" data-tooltip="点击打开角色面板">
                <img src="{{actorImg}}" class="avatar-img">
                <div class="aura-ring {{neigongElement}}"></div>
            </div>
            {{#if realmName}}
            <div class="realm-seal" data-tooltip="当前境界">{{realmName}}</div>
            {{/if}}
            <div class="rage-ring-container">
                {{#each rageDots}}
                <div class="rage-orb {{#if this.active}}active{{/if}}" style="--i:{{@index}}"></div>
                {{/each}}
            </div>
            <div class="rage-core" data-tooltip="当前怒气">
                <i class="fas fa-fire"></i>
                <input type="text" class="res-input rage-input" data-target="system.resources.rage.value"
                    value="{{rage.value}}">
            </div>
        </div>

        <div class="toggle-hud-btn" data-action="toggle-collapse" data-tooltip="折叠/展开 HUD">
            <i class="fas fa-chevron-down"></i>
        </div>
    </div>

    <!-- 3. 右翼：气血内力 -->
    <div class="hud-wing right">
        <div class="bar-group">
            {{#if hutiValue}}
            <div class="huti-badge" data-tooltip="护体真气">
                <i class="fas fa-shield-alt"></i>
                <input type="text" class="res-input huti-input" data-target="system.resources.huti"
                    value="{{hutiValue}}">
            </div>
            {{/if}}
            <div class="res-bar hp">
                <div class="bar-fill" style="width: {{hpPercent}}%;"></div>
                <div class="bar-shield" style="width: {{hutiPercent}}%;"></div>
                <div class="bar-text">
                    <input type="text" class="res-input" data-target="system.resources.hp.value" value="{{hp.value}}">
                    <span class="sep">/</span>
                    <span class="max">{{hp.max}}</span>
                </div>
            </div>
        </div>
        <div class="res-bar mp">
            <div class="bar-fill" style="width: {{mpPercent}}%;"></div>
            <div class="bar-text">
                <input type="text" class="res-input" data-target="system.resources.mp.value" value="{{mp.value}}">
                <span class="sep">/</span>
                <span class="max">{{mp.max}}</span>
            </div>
        </div>
    </div>

    <!-- 4. 底座：万象森罗 -->
    <div class="hud-dock">

        <!-- Tab 1: 常用招式 (需要网格) -->
        <div class="dock-category">
            <div class="cat-btn" data-tooltip="常用招式"><i class="fas fa-fist-raised"></i></div>
            <div class="cat-content">
                <div class="scroll-area">
                    <div class="simple-grid">
                        {{#each shortcuts}}
                        <div class="item-btn move" data-action="use-move" data-item-id="{{item.id}}"
                            data-move-id="{{move.id}}" data-tooltip="{{{tooltip}}}">
                            <img src="{{item.img}}">
                            <span class="label">{{move.name}}</span>
                        </div>
                        {{/each}}
                    </div>
                    {{#unless shortcuts}}
                    <div class="empty-tip" style="color:#666; text-align:center; padding:10px;">无常用招式</div>
                    {{/unless}}
                </div>
            </div>
        </div>

        <!-- Tab 2: 消耗品 (需要网格) -->
        <div class="dock-category">
            <div class="cat-btn" data-tooltip="消耗品"><i class="fas fa-flask"></i></div>
            <div class="cat-content">
                <div class="scroll-area">
                    <div class="simple-grid">
                        {{#each consumables}}
                        <div class="item-btn" data-action="use-item" data-item-id="{{id}}" data-tooltip="{{{tooltip}}}">
                            <img src="{{img}}">
                            <span class="qty">{{system.quantity}}</span>
                            <span class="label">{{name}}</span>
                        </div>
                        {{/each}}
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab 3: 装备 (分组堆叠 -> 组内网格) -->
        <div class="dock-category">
            <div class="cat-btn" data-tooltip="装备"><i class="fas fa-tshirt"></i></div>
            <div class="cat-content">
                <div class="scroll-area">
                    {{#each equipmentGroups}}
                    <div class="equip-group">
                        <div class="group-header" title="点击折叠/展开">
                            <span class="g-label">{{label}}</span>
                            <div class="header-right">
                                <span class="g-count">{{items.length}}</span>
                                <i class="fas fa-chevron-down g-icon"></i>
                            </div>
                        </div>
                        <div class="group-items">
                            {{#each items}}
                            <div class="item-btn {{#if system.equipped}}equipped{{/if}}" data-action="toggle-equip"
                                data-item-id="{{id}}" data-tooltip="{{{tooltip}}}">
                                <img src="{{img}}">
                                {{#if system.equipped}}<i class="fas fa-check equip-mark"></i>{{/if}}
                                <span class="label">{{name}}</span>
                            </div>
                            {{/each}}
                        </div>
                    </div>
                    {{/each}}
                    {{#unless equipmentGroups}}
                    <div class="empty-tip" style="color:#666; text-align:center; padding:10px;">暂无装备</div>
                    {{/unless}}
                </div>
            </div>
        </div>

        <!-- Tab 4: 属性  -->
        <div class="dock-category">
            <div class="cat-btn" data-tooltip="属性/技能"><i class="fas fa-dice-d20"></i></div>
            <div class="cat-content">
                <div class="scroll-area">

                    {{!-- 1. 七维属性分组 --}}
                    {{#each skillGroups}}
                    <div class="equip-group skill-group-wrapper"> <!-- 复用 equip-group 样式 -->

                        <!-- 标题栏: 点击检定属性 (不再折叠，而是直接检定) -->
                        <!-- 技巧: 为了让标题能检定，我们把折叠按钮单独放右边，或者把整个条做成折叠，里面放个检定按钮 -->
                        <!-- 方案: 标题栏左侧检定属性，右侧折叠箭头 -->
                        <div class="group-header">
                            <div class="header-left" data-action="roll-stat" data-key="{{key}}" title="点击检定: {{label}}">
                                <i class="fas fa-dice-d20" style="font-size:10px; margin-right:4px; color:#ffd700"></i>
                                <span class="g-label">{{label}}</span>
                                <span class="g-val"
                                    style="color:#00e676; margin-left:4px; font-weight:bold">{{value}}</span>
                            </div>
                            <!-- 右侧专门用于折叠 -->
                            <div class="header-right toggle-trigger" title="折叠/展开技能">
                                <i class="fas fa-chevron-down g-icon"></i>
                            </div>
                        </div>

                        <!-- 技能列表 (网格) -->
                        <div class="group-items skill-grid">
                            {{#each skills}}
                            <div class="skill-btn" data-action="roll-stat" data-key="{{key}}"
                                data-tooltip="点击检定: {{label}}">
                                <span class="s-name">{{label}}</span>
                                <span class="s-val">{{value}}</span>
                            </div>
                            {{/each}}
                        </div>
                    </div>
                    {{/each}}

                    {{!-- 2. 技艺分组 (如果有) --}}
                    {{#if learnedArts.length}}
                    <div class="equip-group collapsed"> <!-- 默认折叠 -->
                        <div class="group-header toggle-trigger" title="点击展开技艺">
                            <span class="g-label">技艺</span>
                            <div class="header-right">
                                <span class="g-count">{{learnedArts.length}}</span>
                                <i class="fas fa-chevron-down g-icon"></i>
                            </div>
                        </div>
                        <div class="group-items skill-grid">
                            {{#each learnedArts}}
                            <div class="skill-btn art" data-action="roll-stat" data-key="{{key}}">
                                <span class="s-name">{{label}}</span>
                                <span class="s-val">Lv.{{value}}</span>
                            </div>
                            {{/each}}
                        </div>
                    </div>
                    {{/if}}

                </div>
            </div>
        </div>
    </div>
</div>